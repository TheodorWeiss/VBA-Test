let
    Quelle = tbl_Wechsler_matched,

    #"Abgeschnittener Text" =
        Table.TransformColumns(
            Quelle,
            {{"Marke", Text.Trim, type text}}
        ),

    #"Bereinigter Text" =
        Table.TransformColumns(
            #"Abgeschnittener Text",
            {{"Marke", Text.Clean, type text}}
        ),

    #"Abgeschnittener Text1" =
        Table.TransformColumns(
            #"Bereinigter Text",
            {{"Volume", Text.Trim, type text}}
        ),

    #"Bereinigter Text1" =
        Table.TransformColumns(
            #"Abgeschnittener Text1",
            {{"Volume", Text.Clean, type text}}
        ),

    #"Zusammengeführte Abfragen" =
        Table.NestedJoin(
            #"Bereinigter Text1",
            {"Marke", "Volume"},
            tbl_Drotax,
            {"Marke", "Volume"},
            "tbl_Drotax",
            JoinKind.LeftOuter
        ),

    // НОВОЕ: фильтруем вложенную tbl_Drotax по Keyword (жёстко)
    #"tbl_Drotax nach Keyword gefiltert" =
        Table.AddColumn(
            #"Zusammengeführte Abfragen",
            "tbl_Drotax_filtered",
            each
                let
                    kw = Text.From([tbl_Segments.Keywords]),   // пробелы сохраняем, НЕ Trim
                    t  = [tbl_Drotax],
                    res =
                        if kw = null or kw = "" then
                            Table.FirstN(t, 0)
                        else
                            Table.SelectRows(
                                t,
                                each Text.Contains([Produktname], kw, Comparer.OrdinalIgnoreCase)
                            )
                in
                    res,
            type table
        ),

    #"Alte tbl_Drotax entfernt" =
        Table.RemoveColumns(
            #"tbl_Drotax nach Keyword gefiltert",
            {"tbl_Drotax"}
        ),

    #"tbl_Drotax umbenannt" =
        Table.RenameColumns(
            #"Alte tbl_Drotax entfernt",
            {{"tbl_Drotax_filtered", "tbl_Drotax"}}
        ),

    #"Erweiterte tbl_Drotax1" =
        Table.ExpandTableColumn(
            #"tbl_Drotax umbenannt",
            "tbl_Drotax",
            {"Marke", "Kategorie", "Segment", "Gruppe", "Produktname", "Aktionspreis min", "Anbieter", "Kalenderwoche", "% Märkte", "Preistyp", "EAN", "DAN", "Volume"},
            {"Marke.1", "Kategorie", "Segment", "Gruppe", "Produktname", "Aktionspreis min", "Anbieter", "Kalenderwoche", "% Märkte", "Preistyp", "EAN", "DAN", "Volume.1"}
        ),

    #"Andere entfernte Spalten" =
        Table.SelectColumns(
            #"Erweiterte tbl_Drotax1",
            {"Name", "Row_ID", "Marke", "Volume", "tbl_Segments.Keywords", "Kategorie", "Segment", "Gruppe", "Produktname", "Aktionspreis min", "Anbieter", "Kalenderwoche", "% Märkte", "Preistyp", "EAN", "DAN"}
        ),

    #"Gefilterte Zeilen" =
        Table.SelectRows(
            #"Andere entfernte Spalten",
            each true
        ),

    #"Neu angeordnete Spalten" =
        Table.ReorderColumns(
            #"Gefilterte Zeilen",
            {"Name", "Row_ID", "Produktname", "Volume.1", "Marke", "DAN", "EAN", "Preistyp", "% Märkte", "Kalenderwoche", "Anbieter", "Aktionspreis min", "Gruppe", "Kategorie", "Segment"}
        )

in
    #"Neu angeordnete Spalten"
