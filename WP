Да, в старом Excel без TEXTSPLIT самый надёжный путь — VBA UDF (пользовательская функция). Это будет:
	•	строгое совпадение (4000 ≠ 4000298)
	•	работает с ; без пробелов и с пробелами тоже
	•	можно посчитать пересечения “строка vs строка”, и протянуть вниз как обычную формулу

Ниже даю готовый макрос.

⸻

Вариант 1: VBA-функция CountCommonIDs (самое простое и быстрое)

1) Вставь код в модуль VBA
	1.	Alt + F11
	2.	Insert → Module
	3.	Вставь код:

Option Explicit

' Counts how many IDs from list1 are present in list2 (exact match).
' IDs are separated by ";".
' - trims spaces
' - ignores empty tokens
' - treats IDs as text (so 4000 != 4000298)
' - can count unique matches (default) or all matches (set UniqueOnly:=False)
Public Function CountCommonIDs(ByVal list1 As String, ByVal list2 As String, Optional ByVal UniqueOnly As Boolean = True) As Long
    Dim dict2 As Object, seen As Object
    Dim arr1() As String, arr2() As String
    Dim i As Long, key As String
    Dim cnt As Long

    list1 = CStr(list1)
    list2 = CStr(list2)

    ' Quick exits
    If Len(list1) = 0 Or Len(list2) = 0 Then
        CountCommonIDs = 0
        Exit Function
    End If

    Set dict2 = CreateObject("Scripting.Dictionary")
    dict2.CompareMode = vbBinaryCompare ' exact, case-sensitive (digits unaffected)

    ' Build dictionary of IDs from list2
    arr2 = Split(list2, ";")
    For i = LBound(arr2) To UBound(arr2)
        key = Trim$(arr2(i))
        If Len(key) > 0 Then
            If Not dict2.Exists(key) Then dict2.Add key, 1
        End If
    Next i

    If UniqueOnly Then
        Set seen = CreateObject("Scripting.Dictionary")
        seen.CompareMode = vbBinaryCompare
    End If

    ' Count matches for IDs from list1
    arr1 = Split(list1, ";")
    For i = LBound(arr1) To UBound(arr1)
        key = Trim$(arr1(i))
        If Len(key) > 0 Then
            If dict2.Exists(key) Then
                If UniqueOnly Then
                    If Not seen.Exists(key) Then
                        seen.Add key, 1
                        cnt = cnt + 1
                    End If
                Else
                    cnt = cnt + 1
                End If
            End If
        End If
    Next i

    CountCommonIDs = cnt
End Function

2) Использование в Excel

Допустим:
	•	A2 — первая строка BaseID
	•	A3 — вторая строка BaseID

Формула:

=CountCommonIDs(A2;A3)

(В русской/немецкой локали разделитель аргументов обычно ;, у тебя как раз так.)

Протягиваешь вниз — и получаешь количество пересечений между A2 и каждой строкой.

⸻

Частый кейс: “сравнивать всегда с первой строкой”

В B3:

=CountCommonIDs($A$2;A3)

и вниз.

⸻

Важные нюансы (чтобы было “железно”)
	•	Функция считает уникальные совпадения по умолчанию.
То есть если в A3 случайно повторится 123;123, это не даст +2.
	•	Если хочешь считать “как есть” (включая дубликаты в первой строке), используй третий аргумент:

=CountCommonIDs(A2;A3;FALSE)


⸻

Если макросы запрещены политикой компании

Скажи — предложу чисто формульный костыль для старого Excel (через вспомогательные колонки / Power Query / FILTERXML — зависит от версии). Но VBA-UDF обычно быстрее и чище.

Если хочешь, я могу добавить вторую функцию, которая возвращает список совпавших ID (например, 123;456;789), а не только число.
