Отлично, теперь ты в той точке, где из “грязного текста” уже получилась нормальная строка с пробелами между токенами. Дальше логичный следующий шаг — собрать корпус токенов и их статистики (частоты), чтобы потом строить группировку без ручных словарей.

Ниже — самый практичный план (Excel + Power Query), который тянет 20k строк.

⸻

1) Сначала зафиксируй “чистое имя” в отдельной колонке

Пусть это CleanName (то, что ты уже получил формулами + VBA).

Важно: дальше работаем только с CleanName, чтобы пайплайн был воспроизводим.

⸻

2) Разбить CleanName на токены и получить таблицу “документ–токен”

Лучше всего сделать это в Power Query (на формулах будет больно).

Power Query шаги:
	1.	Daten → Aus Tabelle/Bereich
	2.	Выбери колонку CleanName
	3.	Spalte teilen → Nach Trennzeichen → Leerzeichen (Space)
	4.	В “Erweiterte Optionen” выбери In Zeilen aufteilen (split into rows)
	5.	Удали пустые токены (Filter: не null, не пусто)

На выходе будет таблица вида:

RowID (или ArtikelID) | Token

Если у тебя нет RowID — добавь в PQ: Spalte hinzufügen → Indexspalte.

⸻

3) Посчитать частоты токенов (TF) и охват (DF)

Это самый полезный “почти data science” шаг.

3.1 TF — сколько раз токен встречается вообще

В Power Query:
	•	Gruppieren nach → Token
	•	Aggregation: Anzahl Zeilen → TF

3.2 DF — в скольких разных артикулах встречается токен

Для этого:
	•	сначала сделай Duplikate entfernen по паре (ArtikelID, Token)
	•	потом опять Gruppieren nach Token
	•	Aggregation: Anzahl Zeilen → DF

В итоге получишь:

Token | TF | DF

Интерпретация:
	•	высокий TF и высокий DF → “общеязыковые”/служебные токены (типа g, ml, mix, klass, sort)
	•	высокий TF, средний DF → бренды / крупные категории
	•	низкий DF → уникальные вкусы/варианты/ошибки

⸻

4) Отдельно выделить “размерные” токены и “мультипак”

Это важно, чтобы размер не засорял частотный топ.

Сразу заведи флаги:
	•	has_digit (токен содержит цифру) → размеры 500ml, 0.5l, 20x
	•	is_unit (g, kg, ml, l, stk, st, x) — как отдельный класс

В PQ это делается колонкой с условием:
	•	Text.Select([Token], {"0".."9"}) <> "" → содержит цифры

⸻

5) Сделать первый “Cluster Key” без словарей

Когда у тебя есть токены, можно уже получать грубую группировку:

ClusterKey v0 = “топ-N самых информативных токенов в строке”

Практично так:
	•	выкинуть:
	•	токены с цифрами (размер)
	•	единицы измерения (g, ml, l, kg, stk, x)
	•	очень частые токены (например, DF > 30% всех артикулов)
	•	отсортировать оставшиеся токены в строке
	•	склеить в строку token1|token2|token3

Это даст первые “семейства” товаров вообще без ручного словаря.

⸻

Что я бы сделал прямо сейчас у тебя
	1.	Power Query: split into rows → токен-таблица
	2.	Построить таблицу Token|TF|DF и отсортировать по DF
	3.	На основе топов определить:
	•	стоп-токены (автоматически: DF выше порога)
	•	кандидат-бренды (высокий DF, но не слишком высокий, и обычно 1 токен)
	4.	Собрать ClusterKey v0 и посмотреть 20–30 крупнейших кластеров глазами

⸻

Если скажешь, как у тебя называется колонка с уникальным ID артикула (или есть ли она вообще), я дам точные шаги/формулы именно под твою структуру (и можно прямо M-кодом для PQ, чтобы ты просто вставил).
