(txt as nullable text) as text =>
let
    t0 = if txt = null then "" else txt,

    // Разбиваем по твоему стабильному разделителю
    segs = Text.Split(t0, "###"),

    // Функция: из одного сегмента вытаскиваем ПЕРВЫЙ номер по правилу: " пробел + >=4 цифр + пробел "
    FirstArtikelInSeg = (seg as text) as nullable text =>
    let
        s = " " & Text.Trim(seg) & " ",   // добавляем пробелы по краям, чтобы корректно ловить границы
        chars = Text.ToList(s),

        // Бежим слева направо и ищем первый digit-run длиной>=4,
        // который стоит между пробелами: prev=" " и next=" "
        scan =
            List.Accumulate(
                {0..List.Count(chars)-1},
                [cur="", prev=" ", found=null],
                (st, i) =>
                    if st[found] <> null then
                        st
                    else
                        let
                            c = chars{i},
                            isDigit = c >= "0" and c <= "9",
                            next = if i < List.Count(chars)-1 then chars{i+1} else null
                        in
                            if isDigit then
                                // продолжаем ранн цифр
                                [cur = st[cur] & c, prev = st[prev], found = null]
                            else
                                // ранн закончился на st[cur], текущий символ c — НЕ цифра
                                // валидируем ранн только если:
                                // - длина >=4
                                // - prev перед ранном был пробел
                                // - текущий символ (после ранна) = пробел
                                if Text.Length(st[cur]) >= 4 and st[prev] = " " and c = " " then
                                    [cur = "", prev = c, found = st[cur]]
                                else
                                    [cur = "", prev = c, found = null]
            ),

        result = scan[found]
    in
        result,

    // Применяем к каждому сегменту и берём только непустые
    perSeg = List.Transform(segs, each FirstArtikelInSeg(_)),
    cleaned = List.RemoveNulls(perSeg),

    // Склеиваем в список
    res = Text.Combine(cleaned, ";")
in
    res
